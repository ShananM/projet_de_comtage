<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Niveaux de Batterie</title>
  

  <style>
    
    table {
      border-collapse: collapse;
      width: 50%;
      margin: 40px auto;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: left;
    }
    th {
      background-color: #f7f7f7;
    }
    h2 {
      text-align: center;
    }
    .progress-bar-container {
      background-color: #eee;
      border-radius: 5px;
      overflow: hidden;
      height: 20px;
    }
    .progress-bar {
      height: 100%;
      width: 0;
      transition: width 0.5s ease;
    }
    .low {
      background-color: red;
    }
    .medium {
      background-color: orange;
    }
    .high {
      background-color: green;
    }
    .alerte-batterie {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px;
      font-size: 18px;
      font-weight: bold;
      color: white;
      text-align: center;
      z-index: 9999;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <h2>Niveaux de batterie</h2>
  <table>
    <thead>
      <tr>
        <th>RÃ©cepteur / Ã‰metteur</th>
        <th>Niveau de batterie</th>
        <th>Jauge</th>
      </tr>
    </thead>
    <tbody id="batterie-table">
      <!-- Rempli dynamiquement -->
    </tbody>
  </table>

  <script>
    const noms = ['R-A', 'R-B', 'R-C'];//, 'E1', 'E2', 'E3', 'E4', 'E5', 'E6'];

    function getBatteryClass(value) {
      if (value < 4.2) return 'low';
      else if (value < 8.4) return 'medium';
      else return 'high';
    }

    function chargerNiveaux() {
      fetch('../alerte.php')
        .then(response => response.json())
        .then(data => {
          let html = '';

          noms.forEach(nom => {
            const niveau = data[nom] !== undefined ? parseFloat(data[nom]) : null;
            let niveauAffiche = '-';
            let jaugeHTML = '-';

            if (!isNaN(niveau)) {
              const classe = getBatteryClass(niveau);
              const pourcentage = (niveau / 10) * 100;
              niveauAffiche = niveau.toFixed(1);

              jaugeHTML = `
                <div class="progress-bar-container">
                  <div class="progress-bar ${classe}" style="width: ${pourcentage}%"></div>
                </div>
              `;
            }

            html += `
              <tr>
                <td>${nom}</td>
                <td>${niveauAffiche}</td>
                <td>${jaugeHTML}</td>
              </tr>`;
          });

          document.getElementById('batterie-table').innerHTML = html;
        })
        .catch(error => {
          console.error('Erreur de rÃ©cupÃ©ration :', error);
        });
    }

    function verifierAlertesBatterie() {
      fetch('../alerte.php')
        .then(response => response.json())
        .then(data => {
          let alertesRouge = [];
          let alertesOrange = [];

          noms.forEach(nom => {
            const niveau = parseFloat(data[nom]);
            if (!isNaN(niveau)) {
              if (niveau < 4.2) {
                alertesRouge.push(nom);
              } else if (niveau < 8.4) {
                alertesOrange.push(nom);
              }
            }
          });

          document.querySelectorAll('.alerte-batterie').forEach(el => el.remove());

          let message = '';
          if (alertesRouge.length > 0) {
            message += `ðŸ”´ Batterie CRITIQUE : ${alertesRouge.join(', ')}\n`;
          }
          if (alertesOrange.length > 0) {
            message += `ðŸŸ  Batterie FAIBLE : ${alertesOrange.join(', ')}`;
          }

          if (message) {
            const div = document.createElement('div');
            div.className = 'alerte-batterie';
            div.textContent = message;
            div.style.backgroundColor = alertesRouge.length > 0 ? '#f44336' : '#ff9800';
            document.body.appendChild(div);
          }
        })
        .catch(error => {
          console.error('Erreur dâ€™alerte batterie :', error);
        });
    }

    // Lancer au dÃ©marrage + mise Ã  jour
    chargerNiveaux();
    verifierAlertesBatterie();
    setInterval(chargerNiveaux, 5000);
    setInterval(verifierAlertesBatterie, 10000);
  </script>
</body>
</html>
